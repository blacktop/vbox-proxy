#!/bin/bash
#
# Build a static binary for the host OS/ARCH
#

set -eu -o pipefail

echo "Sourcing vars..."
source ./hack/build/vars

echo "Downloading golang deps..."
cd /go/src/"${SOURCE}"
go get -v -d

echo "Building statically linked $TARGET..."
GOOS=linux GOARCH=amd64 go build -buildmode=pie -i -o "${TARGET}" -a -tags netgo -installsuffix netgo -ldflags="${LDFLAGS}" "${SOURCE}"

mv "${TARGET}" build/${CLIENT}